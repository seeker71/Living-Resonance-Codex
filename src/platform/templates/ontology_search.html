<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Living Codex - Ontology Search</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: #2c3e50; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .nav { background: #34495e; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .nav a { color: white; text-decoration: none; margin-right: 20px; padding: 8px 16px; border-radius: 4px; }
        .nav a:hover { background: #2c3e50; }
        .search-container { background: white; padding: 30px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .search-form { display: flex; gap: 15px; margin-bottom: 20px; }
        .search-input { flex: 1; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        .search-input:focus { border-color: #3498db; outline: none; }
        .search-button { padding: 15px 30px; background: #3498db; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; }
        .search-button:hover { background: #2980b9; }
        .search-filters { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .filter-group { display: flex; flex-direction: column; }
        .filter-group label { margin-bottom: 5px; font-weight: bold; color: #2c3e50; }
        .filter-group select, .filter-group input { padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .search-results { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .result-item { padding: 20px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 15px; }
        .result-item:hover { border-color: #3498db; box-shadow: 0 2px 8px rgba(52, 152, 219, 0.2); }
        .result-item h3 { margin: 0 0 10px 0; color: #2c3e50; }
        .result-item .meta { color: #7f8c8d; font-size: 0.9em; margin-bottom: 15px; }
        .result-item .description { margin-bottom: 15px; line-height: 1.6; }
        .result-item .tags { margin-bottom: 15px; }
        .tag { background: #ecf0f1; padding: 4px 8px; border-radius: 12px; font-size: 0.8em; margin-right: 5px; margin-bottom: 5px; display: inline-block; }
        .btn { background: #3498db; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn:hover { background: #2980b9; }
        .btn-secondary { background: #95a5a6; }
        .btn-secondary:hover { background: #7f8c8d; }
        .search-stats { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; }
        .pagination { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
        .pagination a { padding: 8px 12px; background: #3498db; color: white; text-decoration: none; border-radius: 4px; }
        .pagination a:hover { background: #2980b9; }
        .pagination .current { background: #2c3e50; }
        .no-results { text-align: center; padding: 40px; }
        .suggestions { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 20px; }
        .suggestions h4 { margin-top: 0; color: #2c3e50; }
        .suggestion-list { display: flex; flex-wrap: wrap; gap: 10px; }
        .suggestion-item { background: #e8f4fd; padding: 8px 12px; border-radius: 20px; color: #2c3e50; cursor: pointer; }
        .suggestion-item:hover { background: #d1ecf1; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Living Codex - Ontology Search</h1>
            <p>Search across all ontology components, categories, and relationships</p>
        </div>
        
        <div class="nav">
            <a href="{{ url_for('dashboard') }}">üè† Dashboard</a>
            <a href="{{ url_for('discover') }}">üîç Discover</a>
            <a href="{{ url_for('navigate') }}">üß≠ Navigate</a>
            <a href="{{ url_for('contribute') }}">‚úçÔ∏è Contribute</a>
            <a href="{{ url_for('explore_ontology') }}">üåå Ontology</a>
            <a href="{{ url_for('profile') }}">üë§ Profile</a>
            <a href="{{ url_for('logout') }}">üö™ Logout</a>
        </div>
        
        <div class="search-container">
            <h2>üîç Search Ontology</h2>
            
            <form method="GET" action="{{ url_for('ontology_search') }}" class="search-form">
                <input type="text" name="q" placeholder="Search for components, categories, or concepts..." 
                       value="{{ request.args.get('q', '') }}" class="search-input" required>
                <button type="submit" class="search-button">üîç Search</button>
            </form>
            
            <div class="search-filters">
                <div class="filter-group">
                    <label for="category">Category</label>
                    <select name="category" id="category">
                        <option value="">All Categories</option>
                        <option value="core_system">Core System</option>
                        <option value="operational_system">Operational System</option>
                        <option value="interaction_system">Interaction System</option>
                        <option value="collaboration_system">Collaboration System</option>
                        <option value="platform_system">Platform System</option>
                        <option value="discovery_system">Discovery System</option>
                        <option value="navigation_system">Navigation System</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="type">Component Type</label>
                    <select name="type" id="type">
                        <option value="">All Types</option>
                        <option value="module">Module</option>
                        <option value="class">Class</option>
                        <option value="function">Function</option>
                        <option value="interface">Interface</option>
                        <option value="data_structure">Data Structure</option>
                        <option value="algorithm">Algorithm</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="status">Status</label>
                    <select name="status" id="status">
                        <option value="">All Statuses</option>
                        <option value="active">Active</option>
                        <option value="development">Development</option>
                        <option value="deprecated">Deprecated</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="sort">Sort By</label>
                    <select name="sort" id="sort">
                        <option value="relevance">Relevance</option>
                        <option value="name">Name</option>
                        <option value="date">Date</option>
                        <option value="popularity">Popularity</option>
                    </select>
                </div>
            </div>
        </div>
        
        {% if search_query %}
        <div class="search-stats">
            <strong>Search Results for "{{ search_query }}"</strong><br>
            Found {{ total_results }} result{{ 's' if total_results != 1 else '' }} in {{ search_time }} seconds
        </div>
        
        {% if search_results %}
        <div class="search-results">
            {% for result in search_results %}
            <div class="result-item">
                <h3>{{ result.name }}</h3>
                <div class="meta">
                    <strong>Type:</strong> {{ result.type }} | 
                    <strong>Category:</strong> {{ result.category }} | 
                    <strong>Status:</strong> <span style="color: {% if result.status == 'active' %}green{% elif result.status == 'development' %}orange{% else %}red{% endif %};">{{ result.status|title }}</span> | 
                    <strong>Last Updated:</strong> {{ result.last_updated }}
                </div>
                
                <div class="description">
                    {{ result.description }}
                </div>
                
                <div class="tags">
                    {% for tag in result.tags %}
                    <span class="tag">{{ tag }}</span>
                    {% endfor %}
                </div>
                
                <a href="{{ url_for('explore_component', component_id=result.id) }}" class="btn">üîç View Component</a>
                <a href="{{ url_for('explore_ontology_category', category_id=result.category_id) }}" class="btn btn-secondary">üìÅ View Category</a>
            </div>
            {% endfor %}
            
            {% if pagination.pages > 1 %}
            <div class="pagination">
                {% if pagination.has_prev %}
                <a href="{{ url_for('ontology_search', q=search_query, page=pagination.prev_num) }}">‚Üê Previous</a>
                {% endif %}
                
                {% for page_num in pagination.iter_pages() %}
                    {% if page_num %}
                        {% if page_num != pagination.page %}
                        <a href="{{ url_for('ontology_search', q=search_query, page=page_num) }}">{{ page_num }}</a>
                        {% else %}
                        <span class="current">{{ page_num }}</span>
                        {% endif %}
                    {% else %}
                        <span>...</span>
                    {% endif %}
                {% endfor %}
                
                {% if pagination.has_next %}
                <a href="{{ url_for('ontology_search', q=search_query, page=pagination.next_num) }}">Next ‚Üí</a>
                {% endif %}
            </div>
            {% endif %}
        </div>
        
        {% else %}
        <div class="no-results">
            <h3>üîç No results found</h3>
            <p>No components or categories match your search criteria.</p>
            <p>Try:</p>
            <ul style="text-align: left; display: inline-block;">
                <li>Using different keywords</li>
                <li>Checking your spelling</li>
                <li>Using more general terms</li>
                <li>Adjusting your filters</li>
            </ul>
        </div>
        {% endif %}
        
        {% if search_suggestions %}
        <div class="suggestions">
            <h4>üí° Search Suggestions</h4>
            <div class="suggestion-list">
                {% for suggestion in search_suggestions %}
                <span class="suggestion-item" onclick="searchFor('{{ suggestion }}')">{{ suggestion }}</span>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        {% endif %}
        
        <div style="text-align: center; margin-top: 30px;">
            <a href="{{ url_for('explore_ontology') }}" class="btn">üåå Ontology Overview</a>
            <a href="{{ url_for('navigate') }}" class="btn btn-secondary">üß≠ System Navigation</a>
        </div>
    </div>
    
    <script>
        function searchFor(term) {
            document.querySelector('.search-input').value = term;
            document.querySelector('form').submit();
        }
        
        // Apply filters when changed
        document.querySelectorAll('.search-filters select').forEach(select => {
            select.addEventListener('change', function() {
                const form = document.querySelector('form');
                const searchInput = document.querySelector('.search-input');
                if (searchInput.value.trim()) {
                    form.submit();
                }
            });
        });
    </script>
</body>
</html>
